# PostHog Analytics Integration - Complete

## âœ… Integration Status: COMPLETE

PostHog has been successfully integrated into Rounds!

---

## ğŸ”‘ Configuration

**API Key:** `phc_NVtFkrQ9hDhm7Th69dTXo8HiTOLtxPrlwPf0biV4Mql`  
**Region:** US (https://us.i.posthog.com)  
**Package:** Added via Swift Package Manager

---

## ğŸ“Š What's Being Tracked

### App Lifecycle
- âœ… `app_launched` - When the app starts
- âœ… `session_started` - Each app session
- âœ… `session_ended` - With session duration

### Gameplay Events
- âœ… `case_started` - When user begins a case
  - Properties: `case_id`, `is_daily`
- âœ… `case_completed` - When user finishes a case
  - Properties: `case_id`, `won`, `guesses`, `hints_used`, `score`, `is_daily`
- âœ… `hint_revealed` - When user reveals a hint
  - Properties: `hint_index`, `case_id`
- âœ… `streak_milestone` - When user hits streak milestones
  - Properties: `streak_count`
- âœ… `share_results` - When user shares their results
  - Properties: `won`, `score`

### Subscription Events
- âœ… `paywall_viewed` - When paywall is shown
  - Properties: `source`
- âœ… `subscription_purchase_started` - When user initiates purchase
  - Properties: `product_id`
- âœ… `subscription_purchase_completed` - Successful purchase
  - Properties: `product_id`
- âœ… `subscription_purchase_failed` - Failed purchase
  - Properties: `product_id`, `error`
- âœ… `subscription_restored` - When purchases are restored

### Onboarding
- âœ… `onboarding_completed` - User finishes onboarding
- âœ… `onboarding_skipped` - User skips onboarding
  - Properties: `step`

### App Store
- âœ… `review_prompt_shown` - When review prompt appears
- âœ… `review_prompt_manual` - Manual review request

### General
- âœ… `feature_used` - Generic feature usage tracking
  - Properties: `feature`

---

## ğŸ¯ How to Use in Your Code

PostHog is automatically tracking events through `AnalyticsManager.shared`. All existing tracking calls work!

### Examples:

```swift
// Track a custom event
AnalyticsManager.shared.track("custom_event", properties: [
    "key": "value"
])

// Track a feature being used
AnalyticsManager.shared.trackFeatureUsed("case_browser")

// Track paywall view
AnalyticsManager.shared.trackPaywallViewed(source: "daily_case_completed")

// Track hint revealed (already in GameView)
AnalyticsManager.shared.trackHintRevealed(hintIndex: 2, caseID: currentCase.id.uuidString)

// Set user properties
AnalyticsManager.shared.setUserProperty(key: "subscription_tier", value: "pro")

// Or set multiple properties
AnalyticsManager.shared.setUserProperties([
    "total_cases_completed": 50,
    "current_streak": 7,
    "is_pro": true
])
```

---

## ğŸ“± Viewing Your Data

1. **Login to PostHog:** https://app.posthog.com
2. **Navigate to:** Events, Insights, Dashboards, or Session Recordings
3. **View Live Events:** Go to "Activity" to see events in real-time

### Recommended First Steps:

1. **Create a Funnel:**
   - app_launched â†’ case_started â†’ case_completed â†’ subscription_purchase_started â†’ subscription_purchase_completed

2. **Create Insights:**
   - Daily active users
   - Conversion rate to subscription
   - Average hints used per game
   - Win rate over time

3. **Set Up Dashboards:**
   - User Acquisition
   - Engagement Metrics
   - Subscription Metrics
   - Daily Case Performance

---

## ğŸ” Debug Mode

In DEBUG builds, PostHog will:
- âœ… Print events to console with `ğŸ“Š Analytics:` prefix
- âœ… Show event properties
- âœ… Enable PostHog debug logging

In RELEASE builds:
- Events are sent silently
- No console output
- Optimized performance

---

## ğŸ§ª Testing

To verify PostHog is working:

1. **Run the app** in Simulator or on device
2. **Check Xcode console** - Look for `ğŸ“Š PostHog configured in DEBUG mode`
3. **Perform actions** - Play a case, view stats, etc.
4. **Check PostHog dashboard** - Go to Activity â†’ Live Events (may take a few seconds)

### Test Checklist:
- [ ] Launch app - should see `app_launched`
- [ ] Start a case - should see `case_started`
- [ ] Complete a case - should see `case_completed`
- [ ] Reveal a hint - should see `hint_revealed`
- [ ] View paywall - should see `paywall_viewed`

---

## ğŸ›¡ï¸ Privacy & Compliance

### What PostHog Collects:
- **Events** - Actions users take in the app
- **Properties** - Metadata about events (case_id, score, etc.)
- **Device Info** - OS version, device model (standard analytics)
- **Anonymous User ID** - Generated by PostHog, not personally identifiable

### What PostHog DOES NOT Collect:
- âŒ Personal information (unless you explicitly send it)
- âŒ Passwords or credentials
- âŒ Health information
- âŒ Email addresses (unless you choose to identify users)

### GDPR Compliance:
PostHog is GDPR compliant by default. Users are anonymous unless you explicitly identify them.

### Privacy Policy Update:
You should add a section to your privacy policy mentioning analytics:

```
We use PostHog analytics to understand how users interact with our app. 
This helps us improve the user experience. PostHog collects anonymous 
usage data including actions taken in the app and device information. 
No personally identifiable information is collected without your consent.
```

---

## ğŸ“ˆ Useful PostHog Features

### 1. Feature Flags (Future Enhancement)
Control features remotely without app updates:

```swift
if PostHogSDK.shared.isFeatureEnabled("new_game_mode") {
    // Show new feature
}
```

### 2. A/B Testing
Test different UI/UX variations:

```swift
let variant = PostHogSDK.shared.getFeatureFlag("paywall_design")
// Show different paywall based on variant
```

### 3. Session Recordings (Optional)
See exactly how users interact with your app. Enable in PostHog dashboard.

### 4. Surveys (Optional)
Ask users questions directly in the app.

---

## ğŸš€ Next Steps

### Recommended Analytics to Add:

1. **Track when users view specific screens:**
```swift
// In each main view's .onAppear
AnalyticsManager.shared.track("screen_viewed", properties: ["screen": "statistics"])
```

2. **Track category performance:**
```swift
AnalyticsManager.shared.track("category_completed", properties: [
    "category": "Cardiology",
    "accuracy": 0.85
])
```

3. **Track achievement unlocks:**
```swift
AnalyticsManager.shared.track("achievement_unlocked", properties: [
    "achievement": "First Win",
    "timestamp": Date()
])
```

4. **Track user progression:**
```swift
AnalyticsManager.shared.setUserProperties([
    "level": "Intern",
    "total_score": 1500,
    "cases_completed": 25
])
```

---

## ğŸ”§ Advanced Configuration

### User Identification (Optional)

If you want to track users across devices:

```swift
// When user signs in (if you add authentication)
AnalyticsManager.shared.identifyUser(userId: "user_123", properties: [
    "email": "user@example.com",
    "name": "John Doe"
])
```

âš ï¸ **Note:** Only identify users if you have a login system and proper consent!

### Custom Super Properties

Set properties that are included with EVERY event:

```swift
PostHogSDK.shared.register([
    "app_version": Bundle.main.infoDictionary?["CFBundleShortVersionString"] as? String ?? "unknown",
    "is_pro": SubscriptionManager.shared.hasProAccess()
])
```

---

## ğŸ“Š Metrics You Can Track

### Engagement Metrics:
- Daily/Weekly/Monthly Active Users (DAU/WAU/MAU)
- Session length
- Cases completed per session
- Retention rate (1-day, 7-day, 30-day)

### Monetization Metrics:
- Conversion rate (free â†’ pro)
- Revenue (integrate with RevenueCat)
- Average Revenue Per User (ARPU)
- Customer Lifetime Value (LTV)

### Product Metrics:
- Win rate
- Average guesses per case
- Hints used per case
- Completion rate
- Daily case participation rate

### User Journey:
- Onboarding completion rate
- Time to first case
- Time to first win
- Time to subscription

---

## ğŸ› Troubleshooting

### Events Not Showing Up?

1. **Check console for errors:**
   - Look for PostHog debug logs
   - Verify `ğŸ“Š PostHog configured in DEBUG mode` appears

2. **Check API key:**
   - Verify it matches your PostHog project

3. **Check network:**
   - PostHog needs internet connection
   - Events are queued if offline

4. **Wait a moment:**
   - Events can take 5-10 seconds to appear in dashboard

### Debug Commands:

```swift
// Check if PostHog is configured
print("PostHog distinct ID: \(PostHogSDK.shared.getDistinctId())")

// Force flush events (useful for debugging)
PostHogSDK.shared.flush()

// Reset user (useful for testing)
PostHogSDK.shared.reset()
```

---

## ğŸ’¡ Best Practices

1. **Event Names:** Use lowercase with underscores (e.g., `case_completed`)
2. **Properties:** Keep them consistent and typed correctly
3. **Don't Over-Track:** Focus on actionable metrics
4. **User Privacy:** Never track sensitive health/medical info
5. **Test First:** Verify events work before releasing

---

## ğŸ“ Support

- **PostHog Docs:** https://posthog.com/docs
- **PostHog Community:** https://posthog.com/questions
- **Your Account:** https://app.posthog.com

---

## âœ¨ Summary

You're all set! PostHog is now tracking user behavior in Rounds. You can:

âœ… View events in real-time  
âœ… Build funnels and insights  
âœ… Track subscription conversions  
âœ… Measure user engagement  
âœ… Make data-driven decisions  

**Next:** Login to PostHog and explore your data! ğŸš€
